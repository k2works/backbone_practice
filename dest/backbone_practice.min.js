/*! some copyright information here */
window.App={};var initializeNotes=function(){var a=new App.NoteCollection([{title:"テスト１",body:"テスト１です。"},{title:"テスト２",body:"テスト２です。"},{title:"テスト３",body:"テスト３です"}]);return a.each(function(a){a.save()}),a.models};$(function(){App.noteCollection=new App.NoteCollection,App.mainContainer=new App.Container({el:"#main-container"}),App.headerContainer=new App.Container({el:"#header-container"}),App.noteCollection.fetch().then(function(a){if(0===a.length){var b=initializeNotes();App.noteCollection.reset(b)}App.router=new App.Router,Backbone.history.start()})}),App.Container=Backbone.View.extend({show:function(a){this.destroyView(this.currentView),this.$el.append(a.render().$el),this.currentView=a},destroyView:function(a){a&&(a.off(),a.remove())},empty:function(){this.destroyView(this.currentView),this.currentView=null},has:function(a){return this.currentView instanceof a}}),App.Note=Backbone.Model.extend({defaults:{title:"",body:""}}),App.NoteCollection=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("Notes"),model:App.Note}),App.NoteControlView=Backbone.View.extend({events:{"submit .js-search-form":"onSubmit"},render:function(){var a=$("#noteControlView-template").html();return this.$el.html(a),this},onSubmit:function(a){a.preventDefault();var b=this.$(".js-search-query").val();this.trigger("submit:form",b)}}),App.NoteDetailView=Backbone.View.extend({render:function(){var a=$("#noteDetailView-template").html(),b=_.template(a),c=b(this.model.toJSON());return this.$el.html(c),this}}),App.NoteFormView=Backbone.View.extend({render:function(){var a=$("#noteForm-template").html(),b=_.template(a),c=b(this.model.toJSON());return this.$el.html(c),this},events:{"submit form":"onSubmit"},onSubmit:function(a){a.preventDefault();var b={};b.title=this.$(".js-noteTitle").val(),b.body=this.$(".js-noteBody").val(),this.trigger("submit:form",b)}}),App.NoteListView=Backbone.View.extend({tagName:"table",className:"table",initialize:function(a){this.collection=a.collection,this.listenTo(this.collection,"reset",this.render)},render:function(){this.removeItemViews();var a=$("#noteListView-template").html();return this.$el.html(a),this.renderItemViews(),this},renderItemViews:function(){var a=this.$(".js-noteListItemView-container");this.itemViews=this.collection.map(function(b){var c=new App.NoteListItemView({model:b});return a.append(c.render().$el),c},this)},removeItemViews:function(){_.invoke(this.itemView,"remove")}}),App.NoteListItemView=Backbone.View.extend({tagName:"tr",initialize:function(){this.listenTo(this.model,"destroy",this.remove)},events:{"click .js-delete":"onClickDelete"},render:function(){var a=$("#noteListItemView-template").html(),b=_.template(a),c=b(this.model.toJSON());return this.$el.html(c),this},onClickDelete:function(){this.model.destroy()}}),App.Router=Backbone.Router.extend({routes:{"notes/:id":"showNoteDetail","new":"showNewNote","notes/:id/edit":"showEditNote","notes/search/:query":"searchNote","*actions":"defaultRoute"},showNoteDetail:function(a){var b=App.noteCollection.get(a),c=new App.NoteDetailView({model:b});App.mainContainer.show(c),App.headerContainer.empty()},defaultRoute:function(){this.showNoteList(),this.navigate("notes")},showNoteList:function(a){if(this.filteredCollection||(this.filteredCollection=new App.NoteCollection),!App.mainContainer.has(App.NoteListView)){var b=new App.NoteListView({collection:this.filteredCollection});App.mainContainer.show(b)}a=a||App.noteCollection.models,this.filteredCollection.reset(a),this.showNoteControl()},showNoteControl:function(){var a=new App.NoteControlView;a.on("submit:form",function(a){this.searchNote(a),this.navigate("notes/search/"+a)},this),App.headerContainer.show(a)},showNewNote:function(){var a=this,b=new App.NoteFormView({model:new App.Note});b.on("submit:form",function(b){App.noteCollection.create(b),a.showNoteList(),a.navigate("notes")}),App.mainContainer.show(b),App.headerContainer.empty()},showEditNote:function(a){var b=this,c=App.noteCollection.get(a),d=new App.NoteFormView({model:c});d.on("submit:form",function(a){c.save(a),b.showNoteDetail(c.get("id")),b.navigate("notes/"+c.get("id"))}),App.mainContainer.show(d)},searchNote:function(a){var b=App.noteCollection.filter(function(b){return-1!==b.get("title").indexOf(a)});this.showNoteList(b)}});
//# sourceMappingURL=backbone_practice.min.js.map